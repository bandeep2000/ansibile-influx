
- name: install telegraf
  #yum: pkg={{item}} state=present
  yum:
    pkg: ['telegraf']
    state: present
- name: Configure telegraf conf file
  template:
        src: ../files/telegraf.j2
        dest: /etc/telegraf/telegraf.conf
        mode: 0777

- name: restart service telegraf
  when:    ansible_distribution == "RedHat" and ansible_distribution_major_version == "6"
  service:
     name: telegraf
     state: restarted

# Had to add this, since restarting telegraf doesnt catch failing errors
# restart is sending 0 ok status even when it fails , so adding this
- name: Check Telegraf status
  command: service telegraf status
  register: command_result
  failed_when: "'FAILED' in command_result.stdout"
  args:
    warn: false
